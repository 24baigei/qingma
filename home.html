<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>夜班聊天室 · 互动叙事</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Background -->
  <div id="background"></div>

  <!-- Prologue Overlay Chat -->
  <div id="prologue" class="prologue hidden" aria-hidden="true">
    <div class="prologue-container">
      <div id="prologueLog" class="prologue-log"></div>
      <div class="prologue-hint">点击任意位置继续</div>
    </div>
  </div>

  <!-- Top bar controls -->
  <header class="topbar">
    <div class="left">
      <button id="btnNotebook" class="btn primary">💻 笔记本</button>
      <button id="btnMusic" class="btn">🎵 音乐播放器</button>
      <button id="btnNotice" class="btn">📌 公告</button>
      <button id="btnTheme" class="btn">🖥️ 深空灰</button>
      <button id="btnSave" class="btn success">💾 保存剧情</button>
      <button id="btnLoad" class="btn">⟲ 读取剧情</button>
      <button id="btnReset" class="btn danger">↺ 重置剧情</button>
    </div>
  </header>

  <!-- Notebook (Chat UI) -->
  <section id="notebook" class="panel hidden" aria-hidden="true">
    <div class="panel-header">
      <div class="title">夜班聊天室 · 笔记本</div>
      <button class="icon close" id="closeNotebook" aria-label="关闭">✖</button>
    </div>
    <div class="notebook-body">
      <!-- Threads (Group / DMs) -->
      <aside class="threads">
        <div class="thread-title">会话</div>
        <ul id="threadList" class="thread-list">
          <!-- Populated by JS -->
        </ul>
      </aside>
      <!-- Chat window -->
      <div class="chat">
        <div class="chat-header">
          <div class="chat-peer">
            <img id="peerAvatar" src="图片/群头像.png" alt="avatar" />
            <div>
              <div id="peerName" class="peer-name">群聊 · 夜班聊天室</div>
              <div id="peerMeta" class="peer-meta">4 人在线</div>
            </div>
          </div>
          <div class="chat-tools">
            <button id="btnPhone" class="btn tiny easter-egg" title="电话">📞</button>
            <button id="btnVideo" class="btn tiny easter-egg" title="视频通话">📹</button>
            <button id="btnOpenAnalysis" class="btn tiny hidden">打开剩余价值可视化</button>
            <button id="btnOpenHistory" class="btn tiny hidden">历史资料</button>
          </div>
        </div>
        <div id="chatLog" class="chat-log">
          <!-- Messages populated by JS -->
        </div>
        <div id="choiceBar" class="choice-bar hidden">
          <!-- Choice buttons populated by JS -->
        </div>
      </div>
    </div>
  </section>

  <!-- Music Player (NetEase-like) -->
  <section id="musicPlayer" class="panel right hidden" aria-hidden="true">
    <div class="panel-header">
      <div class="title">音乐播放器</div>
      <button class="icon close" id="closeMusic" aria-label="关闭">✖</button>
    </div>
    <div class="music-body">
      <div class="disc-wrap">
        <div class="disc" id="disc">
          <img src="图片/耄耋.png" alt="disc" />
        </div>
      </div>
      <div class="controls">
        <div class="timing">
          <span id="currentTime">0:00</span>
          <div class="progress">
            <div id="progressBar" class="progress-bar"></div>
          </div>
          <span id="duration">0:00</span>
        </div>
        <div class="buttons">
          <button id="btnPrevTrack" class="btn round">⏮</button>
          <button id="btnPlayPause" class="btn round accent">▶</button>
          <button id="btnNextTrack" class="btn round">⏭</button>
        </div>
      </div>
      <div class="playlist">
        <div class="list-title">播放列表</div>
        <ul id="trackList" class="track-list"></ul>
      </div>
      <audio id="audio" preload="metadata"></audio>
    </div>
  </section>

  <!-- Notice Board -->
  <section id="noticeBoard" class="panel left hidden" aria-hidden="true">
    <div class="panel-header">
      <div class="title">公告板</div>
      <button class="icon close" id="closeNotice" aria-label="关闭">✖</button>
    </div>
    <div class="notice-body">
      <div class="notice-card">
        <div class="notice-title">使用说明</div>
        <ul>
          <li>点击上方“笔记本”打开聊天工具（群聊/私聊）。</li>
          <li>“DasKapital（马克思）”会在特定剧情后解锁。</li>
          <li>张宇篇中可打开“剩余价值可视化”。</li>
        </ul>
      </div>
      <div class="notice-card">
        <div class="notice-title">当前目标</div>
        <ul id="objectiveList">
          <!-- Populated by JS -->
        </ul>
      </div>
      <div class="notice-card">
        <div class="notice-title">操作提示</div>
        <ul>
          <li>点击聊天窗口逐条推进对话（一次点击仅出现一条）。</li>
          <li>在有选项时，点击选项推进分支。</li>
          <li>音乐播放器可随时播放/切歌。</li>
        </ul>
      </div>
      <div class="notice-card">
        <div class="notice-title">剧情播放速度</div>
        <div class="speed-controls">
          <button id="speedSlow" class="btn">慢</button>
          <button id="speedMedium" class="btn">中</button>
          <button id="speedFast" class="btn">快</button>
          <div class="speed-value">当前：<span id="speedValue">1000</span>ms</div>
        </div>
        <div class="range-wrap">
          <input id="speedSlider" type="range" min="300" max="2000" step="50" value="1000" />
        </div>
        <div class="speed-desc">提示：点击聊天窗口可“快进”当前段落；选项按钮不会触发快进。</div>
      </div>
    </div>
  </section>

  <!-- Transition overlay -->
  <div id="transition" class="transition hidden" aria-hidden="true">
    <div class="transition-text" id="transitionText">…</div>
  </div>

  <!-- Modal for analysis page -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-bar">
        <div class="title">剩余价值可视化</div>
        <button id="closeModal" class="icon close">✖</button>
      </div>
      <iframe id="analysisFrame" src="" title="剩余价值可视化"></iframe>
    </div>
  </div>

  <!-- Modal for pre-chat history -->
  <div id="historyModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-bar">
        <div class="title">历史资料</div>
        <button id="closeHistoryModal" class="icon close">✖</button>
      </div>
      <div id="historyLog" class="history-log prologue-log"></div>
      <div class="prologue-hint">点击任意位置继续</div>
    </div>
  </div>

  <!-- Modal for profile dossier unlock -->
  <div id="profileModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content card">
      <div class="modal-bar">
        <div class="title">角色档案解锁</div>
        <button id="closeProfileModal" class="icon close" aria-label="关闭">✖</button>
      </div>
      <div class="profile-card">
        <img id="profileAvatar" class="profile-avatar" src="图片/群头像.png" alt="avatar" />
        <div class="profile-info">
          <div id="profileName" class="profile-name">—</div>
          <div id="profileMeta" class="profile-meta">—</div>
          <ul id="profileBullets" class="profile-bullets"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Easter Egg Modals -->
  <div id="easterEggModal" class="easter-egg-modal hidden">
    <div class="easter-egg-content">
      <div class="easter-egg-header">
        <span id="easterEggTitle"></span>
        <button id="closeEasterEgg" class="close-btn">✖</button>
      </div>
      <div id="easterEggBody" class="easter-egg-body"></div>
    </div>
  </div>

  <script src="main.js"></script>
</body>
</html>
